var expect=require("expect.js"),cheerio=require("../.."),fruits=require("../fixtures").fruits,vegetables=require("../fixtures").vegetables,food=require("../fixtures").food,chocolates=require("../fixtures").chocolates,inputs=require("../fixtures").inputs,toArray=Function.call.bind(Array.prototype.slice);describe("$(...)",function(){var a;beforeEach(function(){a=cheerio.load(fruits)}),describe(".attr",function(){it("() : should get all the attributes",function(){var b=a("ul").attr();expect(b.id).to.equal("fruits")}),it("(invalid key) : invalid attr should get undefined",function(){var b=a(".apple").attr("lol");expect(b).to.be(void 0)}),it("(valid key) : valid attr should get value",function(){var b=a(".apple").attr("class");expect(b).to.equal("apple")}),it("(valid key) : valid attr should get name when boolean",function(){var b=a("<input name=email autofocus>").attr("autofocus");expect(b).to.equal("autofocus")}),it("(key, value) : should set attr",function(){var b=a(".pear").attr("id","pear");expect(a("#pear")).to.have.length(1),expect(b).to.be.a(a)}),it("(key, value) : should set attr",function(){var a=cheerio("<div></div> <div></div>").attr("class","pear");expect(a[0].attribs["class"]).to.equal("pear"),expect(a[1].attribs).to.equal(void 0),expect(a[2].attribs["class"]).to.equal("pear")}),it("(key, value) : should return an empty object for an empty object",function(){var b=a().attr("key","value");expect(b.length).to.equal(0),expect(b[0]).to.be(void 0)}),it("(map) : object map should set multiple attributes",function(){a(".apple").attr({id:"apple",style:"color:red;","data-url":"http://apple.com"});var b=a(".apple").attr();expect(b.id).to.equal("apple"),expect(b.style).to.equal("color:red;"),expect(b["data-url"]).to.equal("http://apple.com")}),it("(key, function) : should call the function and update the attribute with the return value",function(){var b=a("#fruits");b.attr("id",function(a,b){return expect(a).to.equal(0),expect(b).to.equal("fruits"),"ninja"});var c=b.attr();expect(c.id).to.equal("ninja")}),it("(key, value) : should correctly encode then decode unsafe values",function(){var b=a(".apple");b.attr("href",'http://github.com/"><script>alert("XSS!")</script><br'),expect(b.attr("href")).to.equal('http://github.com/"><script>alert("XSS!")</script><br'),b.attr("href",'http://github.com/"><script>alert("XSS!")</script><br'),expect(b.html()).to.not.contain('<script>alert("XSS!")</script>')}),it("(key, value) : should coerce values to a string",function(){var b=a(".apple");b.attr("data-test",1),expect(b[0].attribs["data-test"]).to.equal("1"),expect(b.attr("data-test")).to.equal("1")}),it("(key, value) : handle removed boolean attributes",function(){var b=a(".apple");b.attr("autofocus","autofocus"),expect(b.attr("autofocus")).to.equal("autofocus"),b.removeAttr("autofocus"),expect(b.attr("autofocus")).to.be(void 0)}),it("(key, value) : should remove non-boolean attributes with names or values similar to boolean ones",function(){var b=a(".apple");b.attr("data-autofocus","autofocus"),expect(b.attr("data-autofocus")).to.equal("autofocus"),b.removeAttr("data-autofocus"),expect(b.attr("data-autofocus")).to.be(void 0)})}),describe(".data",function(){beforeEach(function(){a=cheerio.load(chocolates)}),it("() : should get all data attributes initially declared in the markup",function(){var b=a(".linth").data();expect(b).to.eql({highlight:"Lindor",origin:"swiss"})}),it("() : should get all data set via `data`",function(){var a=cheerio("<div>");a.data("a",1),a.data("b",2),expect(a.data()).to.eql({a:1,b:2})}),it("() : should get all data attributes initially declared in the markup merged with all data additionally set via `data`",function(){var a=cheerio('<div data-a="a">');a.data("b","b"),expect(a.data()).to.eql({a:"a",b:"b"})}),it("() : no data attribute should return an empty object",function(){var b=a(".cailler").data();expect(b).to.be.empty()}),it("(invalid key) : invalid data attribute should return `undefined` ",function(){var b=a(".frey").data("lol");expect(b).to.be(void 0)}),it("(valid key) : valid data attribute should get value",function(){var b=a(".linth").data("highlight"),c=a(".linth").data("origin");expect(b).to.equal("Lindor"),expect(c).to.equal("swiss")}),it("(key) : should translate camel-cased key values to hyphen-separated versions",function(){var a=cheerio('<div data--three-word-attribute="a" data-foo-Bar_BAZ-="b">');expect(a.data("ThreeWordAttribute")).to.be("a"),expect(a.data("fooBar_baz-")).to.be("b")}),it("(key) : should retrieve object values",function(){var a={},b=cheerio("<div>");b.data("test",a),expect(b.data("test")).to.be(a)}),it("(key) : should parse JSON data derived from the markup",function(){var a=cheerio('<div data-json="[1, 2, 3]">');expect(a.data("json")).to.eql([1,2,3])}),it("(key) : should not parse JSON data set via the `data` API",function(){var a=cheerio("<div>");a.data("json","[1, 2, 3]"),expect(a.data("json")).to.be("[1, 2, 3]")}),it("(key) : should ignore the markup value after the first access",function(){var a=cheerio('<div data-test="a">');expect(a.data("test")).to.be("a"),a.attr("data-test","b"),expect(a.data("test")).to.be("a")}),it("(key) : should recover from malformed JSON",function(){var a=cheerio('<div data-custom="{{templatevar}}">');expect(a.data("custom")).to.be("{{templatevar}}")}),it("(hyphen key) : data addribute with hyphen should be camelized ;-)",function(){var b=a(".frey").data();expect(b).to.eql({taste:"sweet",bestCollection:"Mahony"})}),it("(key, value) : should set data attribute",function(){var b=a(".frey").data({balls:"giandor"}),c=a(".linth").data("snack","chocoletti");expect(b.data("balls")).to.eql("giandor"),expect(c.data("snack")).to.eql("chocoletti")}),it("(map) : object map should set multiple data attributes",function(){var b=a(".linth").data({id:"Cailler",flop:"Pippilotti Rist",top:"Frigor",url:"http://www.cailler.ch/"})[0].data;expect(b.id).to.equal("Cailler"),expect(b.flop).to.equal("Pippilotti Rist"),expect(b.top).to.equal("Frigor"),expect(b.url).to.equal("http://www.cailler.ch/")}),describe("(attr) : data-* attribute type coercion :",function(){it("boolean",function(){var a=cheerio('<div data-bool="true">');expect(a.data("bool")).to.be(!0)}),it("number",function(){var a=cheerio('<div data-number="23">');expect(a.data("number")).to.be(23)}),it("number (scientific notation is not coerced)",function(){var a=cheerio('<div data-sci="1E10">');expect(a.data("sci")).to.be("1E10")}),it("null",function(){var a=cheerio('<div data-null="null">');expect(a.data("null")).to.be(null)}),it("object",function(){var a=cheerio("<div data-obj='{ \"a\": 45 }'>");expect(a.data("obj")).to.eql({a:45})}),it("array",function(){var a=cheerio('<div data-array="[1, 2, 3]">');expect(a.data("array")).to.eql([1,2,3])})})}),describe(".val",function(){beforeEach(function(){a=cheerio.load(inputs)}),it(".val(): on select should get value",function(){var b=a("select#one").val();expect(b).to.equal("option_selected")}),it(".val(): on option should get value",function(){var b=a("select#one option").eq(0).val();expect(b).to.equal("option_not_selected")}),it(".val(): on text input should get value",function(){var b=a('input[type="text"]').val();expect(b).to.equal("input_text")}),it(".val(): on checked checkbox should get value",function(){var b=a('input[name="checkbox_on"]').val();expect(b).to.equal("on")}),it(".val(): on unchecked checkbox should get value",function(){var b=a('input[name="checkbox_off"]').val();expect(b).to.equal("off")}),it(".val(): on radio should get value",function(){var b=a('input[type="radio"]').val();expect(b).to.equal("off")}),it(".val(): on multiple select should get an array of values",function(){var b=a("select#multi").val();expect(b).to.have.length(2)}),it(".val(value): on input text should set value",function(){var b=a('input[type="text"]').val("test");expect(b.val()).to.equal("test")}),it(".val(value): on select should set value",function(){var b=a("select#one").val("option_not_selected");expect(b.val()).to.equal("option_not_selected")}),it(".val(value): on option should set value",function(){var b=a("select#one option").eq(0).val("option_changed");expect(b.val()).to.equal("option_changed")}),it(".val(value): on radio should set value",function(){var b=a('input[name="radio"]').val("off");expect(b.val()).to.equal("off")}),it(".val(value): on radio with special characters should set value",function(){var b=a('input[name="radio[brackets]"]').val("off");expect(b.val()).to.equal("off")}),it(".val(values): on multiple select should set multiple values",function(){var b=a("select#multi").val(["1","3","4"]);expect(b.val()).to.have.length(3)})}),describe(".removeAttr",function(){it("(key) : should remove a single attr",function(){var b=a("#fruits");expect(b.attr("id")).to.not.be(void 0),b.removeAttr("id"),expect(b.attr("id")).to.be(void 0)}),it("should return cheerio object",function(){var b=a("ul").removeAttr("id");expect(b).to.be.a(a)})}),describe(".hasClass",function(){function b(a){return cheerio('<div class="'+a+'"></div>')}it("(valid class) : should return true",function(){var c=a(".apple").hasClass("apple");expect(c).to.be.ok(),expect(b("foo").hasClass("foo")).to.be.ok(),expect(b("foo bar").hasClass("foo")).to.be.ok(),expect(b("bar foo").hasClass("foo")).to.be.ok(),expect(b("bar foo bar").hasClass("foo")).to.be.ok()}),it("(invalid class) : should return false",function(){var c=a("#fruits").hasClass("fruits");expect(c).to.not.be.ok(),expect(b("foo-bar").hasClass("foo")).to.not.be.ok(),expect(b("foo-bar").hasClass("foo")).to.not.be.ok(),expect(b("foo-bar").hasClass("foo-ba")).to.not.be.ok()}),it("should check multiple classes",function(){a(".apple").addClass("red"),expect(a(".apple").hasClass("apple")).to.be.ok(),expect(a(".apple").hasClass("red")).to.be.ok(),a(".apple").removeClass("apple"),expect(a("li").eq(0).hasClass("apple")).to.not.be.ok()})}),describe(".addClass",function(){it("(first class) : should add the class to the element",function(){var b=a("#fruits");b.addClass("fruits");var c=b.hasClass("fruits");expect(c).to.be.ok()}),it("(single class) : should add the class to the element",function(){a(".apple").addClass("fruit");var b=a(".apple").hasClass("fruit");expect(b).to.be.ok()}),it("(class): adds classes to many selected items",function(){a("li").addClass("fruit"),expect(a(".apple").hasClass("fruit")).to.be.ok(),expect(a(".orange").hasClass("fruit")).to.be.ok(),expect(a(".pear").hasClass("fruit")).to.be.ok()}),it("(class class class) : should add multiple classes to the element",function(){a(".apple").addClass("fruit red tasty"),expect(a(".apple").hasClass("apple")).to.be.ok(),expect(a(".apple").hasClass("fruit")).to.be.ok(),expect(a(".apple").hasClass("red")).to.be.ok(),expect(a(".apple").hasClass("tasty")).to.be.ok()}),it("(fn) : should add classes returned from the function",function(){var b=a("#fruits").children(),c=[],d=[],e=["apple red","",void 0];b.addClass(function(a){return c.push(toArray(arguments)),d.push(this),e[a]}),expect(c).to.eql([[0,"apple"],[1,"orange"],[2,"pear"]]),expect(d).to.eql([b[0],b[1],b[2]]),expect(b.eq(0).hasClass("apple")).to.be.ok(),expect(b.eq(0).hasClass("red")).to.be.ok(),expect(b.eq(1).hasClass("orange")).to.be.ok(),expect(b.eq(2).hasClass("pear")).to.be.ok()})}),describe(".removeClass",function(){it("() : should remove all the classes",function(){a(".pear").addClass("fruit"),a(".pear").removeClass(),expect(a(".pear").attr("class")).to.be(void 0)}),it('("") : should not modify class list',function(){var b=a("#fruits");b.children().removeClass(""),expect(a(".apple")).to.have.length(1)}),it("(invalid class) : should not remove anything",function(){a(".pear").removeClass("fruit"),expect(a(".pear").hasClass("pear")).to.be.ok()}),it("(no class attribute) : should not throw an exception",function(){var b=cheerio(vegetables);expect(function(){a("li",b).removeClass("vegetable")}).to.not.throwException()}),it("(single class) : should remove a single class from the element",function(){a(".pear").addClass("fruit"),expect(a(".pear").hasClass("fruit")).to.be.ok(),a(".pear").removeClass("fruit"),expect(a(".pear").hasClass("fruit")).to.not.be.ok(),expect(a(".pear").hasClass("pear")).to.be.ok()}),it("(single class) : should remove a single class from multiple classes on the element",function(){a(".pear").addClass("fruit green tasty"),expect(a(".pear").hasClass("fruit")).to.be.ok(),expect(a(".pear").hasClass("green")).to.be.ok(),expect(a(".pear").hasClass("tasty")).to.be.ok(),a(".pear").removeClass("green"),expect(a(".pear").hasClass("fruit")).to.be.ok(),expect(a(".pear").hasClass("green")).to.not.be.ok(),expect(a(".pear").hasClass("tasty")).to.be.ok()}),it("(class class class) : should remove multiple classes from the element",function(){a(".apple").addClass("fruit red tasty"),expect(a(".apple").hasClass("apple")).to.be.ok(),expect(a(".apple").hasClass("fruit")).to.be.ok(),expect(a(".apple").hasClass("red")).to.be.ok(),expect(a(".apple").hasClass("tasty")).to.be.ok(),a(".apple").removeClass("apple red tasty"),expect(a(".fruit").hasClass("apple")).to.not.be.ok(),expect(a(".fruit").hasClass("red")).to.not.be.ok(),expect(a(".fruit").hasClass("tasty")).to.not.be.ok(),expect(a(".fruit").hasClass("fruit")).to.be.ok()}),it("(class) : should remove all occurrences of a class name",function(){var a=cheerio('<div class="x x y x z"></div>');expect(a.removeClass("x").hasClass("x")).to.be(!1)}),it("(fn) : should remove classes returned from the function",function(){var b=a("#fruits").children(),c=[],d=[],e=["apple red","",void 0];b.removeClass(function(a){return c.push(toArray(arguments)),d.push(this),e[a]}),expect(c).to.eql([[0,"apple"],[1,"orange"],[2,"pear"]]),expect(d).to.eql([b[0],b[1],b[2]]),expect(b.eq(0).hasClass("apple")).to.not.be.ok(),expect(b.eq(0).hasClass("red")).to.not.be.ok(),expect(b.eq(1).hasClass("orange")).to.be.ok(),expect(b.eq(2).hasClass("pear")).to.be.ok()})}),describe(".toggleClass",function(){it("(class class) : should toggle multiple classes from the element",function(){a(".apple").addClass("fruit"),expect(a(".apple").hasClass("apple")).to.be.ok(),expect(a(".apple").hasClass("fruit")).to.be.ok(),expect(a(".apple").hasClass("red")).to.not.be.ok(),a(".apple").toggleClass("apple red"),expect(a(".fruit").hasClass("apple")).to.not.be.ok(),expect(a(".fruit").hasClass("red")).to.be.ok(),expect(a(".fruit").hasClass("fruit")).to.be.ok()}),it("(class class, true) : should add multiple classes to the element",function(){a(".apple").addClass("fruit"),expect(a(".apple").hasClass("apple")).to.be.ok(),expect(a(".apple").hasClass("fruit")).to.be.ok(),expect(a(".apple").hasClass("red")).to.not.be.ok(),a(".apple").toggleClass("apple red",!0),expect(a(".fruit").hasClass("apple")).to.be.ok(),expect(a(".fruit").hasClass("red")).to.be.ok(),expect(a(".fruit").hasClass("fruit")).to.be.ok()}),it("(class true) : should add only one instance of class",function(){a(".apple").toggleClass("tasty",!0),a(".apple").toggleClass("tasty",!0),expect(a(".apple").attr("class").match(/tasty/g).length).to.equal(1)}),it("(class class, false) : should remove multiple classes from the element",function(){a(".apple").addClass("fruit"),expect(a(".apple").hasClass("apple")).to.be.ok(),expect(a(".apple").hasClass("fruit")).to.be.ok(),expect(a(".apple").hasClass("red")).to.not.be.ok(),a(".apple").toggleClass("apple red",!1),expect(a(".fruit").hasClass("apple")).to.not.be.ok(),expect(a(".fruit").hasClass("red")).to.not.be.ok(),expect(a(".fruit").hasClass("fruit")).to.be.ok()}),it("(fn) : should toggle classes returned from the function",function(){a=cheerio.load(food),a(".apple").addClass("fruit"),a(".carrot").addClass("vegetable"),expect(a(".apple").hasClass("fruit")).to.be.ok(),expect(a(".apple").hasClass("vegetable")).to.not.be.ok(),expect(a(".orange").hasClass("fruit")).to.not.be.ok(),expect(a(".orange").hasClass("vegetable")).to.not.be.ok(),expect(a(".carrot").hasClass("fruit")).to.not.be.ok(),expect(a(".carrot").hasClass("vegetable")).to.be.ok(),expect(a(".sweetcorn").hasClass("fruit")).to.not.be.ok(),expect(a(".sweetcorn").hasClass("vegetable")).to.not.be.ok(),a("li").toggleClass(function(){return a(this).parent().is("#fruits")?"fruit":"vegetable"}),expect(a(".apple").hasClass("fruit")).to.not.be.ok(),expect(a(".apple").hasClass("vegetable")).to.not.be.ok(),expect(a(".orange").hasClass("fruit")).to.be.ok(),expect(a(".orange").hasClass("vegetable")).to.not.be.ok(),expect(a(".carrot").hasClass("fruit")).to.not.be.ok(),expect(a(".carrot").hasClass("vegetable")).to.not.be.ok(),expect(a(".sweetcorn").hasClass("fruit")).to.not.be.ok(),expect(a(".sweetcorn").hasClass("vegetable")).to.be.ok()})}),describe(".is",function(){it("() : should return false",function(){expect(a("li.apple").is()).to.be(!1)}),it("(true selector) : should return true",function(){expect(cheerio("#vegetables",vegetables).is("ul")).to.be(!0)}),it("(false selector) : should return false",function(){expect(cheerio("#vegetables",vegetables).is("div")).to.be(!1)}),it("(true selection) : should return true",function(){var a=cheerio("li",vegetables);expect(a.is(a.eq(1))).to.be(!0)}),it("(false selection) : should return false",function(){var a=cheerio(vegetables),b=a.find("li");expect(b.is(a)).to.be(!1)}),it("(true element) : should return true",function(){var a=cheerio("li",vegetables);expect(a.is(a[0])).to.be(!0)}),it("(false element) : should return false",function(){var a=cheerio(vegetables),b=a.find("li");expect(b.is(a[0])).to.be(!1)}),it("(true predicate) : should return true",function(){var b=a("li").is(function(){return"li"===this.tagName&&a(this).hasClass("pear")});expect(b).to.be(!0)}),it("(false predicate) : should return false",function(){var b=a("li").last().is(function(){return"ul"===this.tagName});expect(b).to.be(!1)})})});
var expect=require("expect.js"),cheerio=require("../.."),fruits=require("../fixtures").fruits,toArray=Function.call.bind(Array.prototype.slice);describe("$(...)",function(){var a,b;beforeEach(function(){a=cheerio.load(fruits),b=a("#fruits")}),describe(".append",function(){it("() : should do nothing",function(){expect(a("#fruits").append()[0].tagName).to.equal("ul")}),it("(html) : should add element as last child",function(){b.append('<li class="plum">Plum</li>'),expect(b.children().eq(3).hasClass("plum")).to.be.ok()}),it("($(...)) : should add element as last child",function(){var c=a('<li class="plum">Plum</li>');b.append(c),expect(b.children().eq(3).hasClass("plum")).to.be.ok()}),it("(Node) : should add element as last child",function(){var c=a('<li class="plum">Plum</li>')[0];b.append(c),expect(b.children().eq(3).hasClass("plum")).to.be.ok()}),it("(existing Node) : should remove node from previous location",function(){var a,c=b.children()[0];expect(b.children()).to.have.length(3),b.append(c),a=b.children(),expect(a).to.have.length(3),expect(a[0]).to.not.equal(c),expect(a[2]).to.equal(c)}),it("(existing Node) : should remove existing node from previous location",function(){var c,d=b.children()[0],e=a("<div></div>");expect(b.children()).to.have.length(3),e.append(d),c=b.children(),expect(c).to.have.length(2),expect(c[0]).to.not.equal(d),expect(e.children()).to.have.length(1),expect(e.children()[0]).to.equal(d)}),it("(existing Node) : should update original direct siblings",function(){a(".pear").append(a(".orange")),expect(a(".apple").next()[0]).to.be(a(".pear")[0]),expect(a(".pear").prev()[0]).to.be(a(".apple")[0])}),it("(existing Node) : should clone all but the last occurrence",function(){var b,c=a(".apple");a(".orange, .pear").append(c),b=a(".apple"),expect(b).to.have.length(2),expect(b.eq(0).parent()[0]).to.be(a(".orange")[0]),expect(b.eq(1).parent()[0]).to.be(a(".pear")[0]),expect(b[1]).to.be(c[0])}),it("(elem) : should NOP if removed",function(){var c=a(".apple");c.remove(),b.append(c),expect(b.children().eq(2).hasClass("apple")).to.be.ok()}),it("($(...), html) : should add multiple elements as last children",function(){var c=a('<li class="plum">Plum</li>'),d='<li class="grape">Grape</li>';b.append(c,d),expect(b.children().eq(3).hasClass("plum")).to.be.ok(),expect(b.children().eq(4).hasClass("grape")).to.be.ok()}),it("(Array) : should append all elements in the array",function(){var c=a('<li class="plum">Plum</li><li class="grape">Grape</li>').get();b.append(c),expect(b.children().eq(3).hasClass("plum")).to.be.ok(),expect(b.children().eq(4).hasClass("grape")).to.be.ok()}),it("(fn) : should invoke the callback with the correct arguments and context",function(){b=b.children();var a=[],c=[];b.append(function(){a.push(toArray(arguments)),c.push(this)}),expect(a).to.eql([[0,"Apple"],[1,"Orange"],[2,"Pear"]]),expect(c).to.eql([b[0],b[1],b[2]])}),it("(fn) : should add returned string as last child",function(){b=b.children();var a,c,d;b.append(function(){return'<div class="first">'}),a=b.eq(0),c=b.eq(1),d=b.eq(2),expect(a.find(".first")[0]).to.equal(a.contents()[1]),expect(c.find(".first")[0]).to.equal(c.contents()[1]),expect(d.find(".first")[0]).to.equal(d.contents()[1])}),it("(fn) : should add returned Cheerio object as last child",function(){var c,d,e;b=b.children(),b.append(function(){return a('<div class="second">')}),c=b.eq(0),d=b.eq(1),e=b.eq(2),expect(c.find(".second")[0]).to.equal(c.contents()[1]),expect(d.find(".second")[0]).to.equal(d.contents()[1]),expect(e.find(".second")[0]).to.equal(e.contents()[1])}),it("(fn) : should add returned Node as last child",function(){var c,d,e;b=b.children(),b.append(function(){return a('<div class="third">')[0]}),c=b.eq(0),d=b.eq(1),e=b.eq(2),expect(c.find(".third")[0]).to.equal(c.contents()[1]),expect(d.find(".third")[0]).to.equal(d.contents()[1]),expect(e.find(".third")[0]).to.equal(e.contents()[1])}),it("should maintain correct object state (Issue: #10)",function(){var b=a("<div></div>").append("<div><div></div></div>").children().children().parent();expect(b).to.be.ok()}),it("($(...)) : should remove from root element",function(){var c=a('<li class="plum">Plum</li>'),d=c[0].root;expect(d).to.be.ok(),b.append(c),expect(c[0].root).to.not.be.ok(),expect(d.childNodes).to.not.contain(c[0])})}),describe(".prepend",function(){it("() : should do nothing",function(){expect(a("#fruits").prepend()[0].tagName).to.equal("ul")}),it("(html) : should add element as first child",function(){b.prepend('<li class="plum">Plum</li>'),expect(b.children().eq(0).hasClass("plum")).to.be.ok()}),it("($(...)) : should add element as first child",function(){var c=a('<li class="plum">Plum</li>');b.prepend(c),expect(b.children().eq(0).hasClass("plum")).to.be.ok()}),it("(Node) : should add node as first child",function(){var c=a('<li class="plum">Plum</li>')[0];b.prepend(c),expect(b.children().eq(0).hasClass("plum")).to.be.ok()}),it("(existing Node) : should remove existing nodes from previous locations",function(){var a,c=b.children()[2];expect(b.children()).to.have.length(3),b.prepend(c),a=b.children(),expect(a).to.have.length(3),expect(a[2]).to.not.equal(c),expect(a[0]).to.equal(c)}),it("(existing Node) : should update original direct siblings",function(){a(".pear").prepend(a(".orange")),expect(a(".apple").next()[0]).to.be(a(".pear")[0]),expect(a(".pear").prev()[0]).to.be(a(".apple")[0])}),it("(existing Node) : should clone all but the last occurrence",function(){var b,c=a(".apple");a(".orange, .pear").prepend(c),b=a(".apple"),expect(b).to.have.length(2),expect(b.eq(0).parent()[0]).to.be(a(".orange")[0]),expect(b.eq(1).parent()[0]).to.be(a(".pear")[0]),expect(b[1]).to.be(c[0])}),it("(elem) : should handle if removed",function(){var c=a(".apple");c.remove(),b.prepend(c),expect(b.children().eq(0).hasClass("apple")).to.be.ok()}),it("(Array) : should add all elements in the array as inital children",function(){var c=a('<li class="plum">Plum</li><li class="grape">Grape</li>').get();b.prepend(c),expect(b.children().eq(0).hasClass("plum")).to.be.ok(),expect(b.children().eq(1).hasClass("grape")).to.be.ok()}),it("(html, $(...), html) : should add multiple elements as first children",function(){var c=a('<li class="plum">Plum</li>'),d='<li class="grape">Grape</li>';b.prepend(c,d),expect(b.children().eq(0).hasClass("plum")).to.be.ok(),expect(b.children().eq(1).hasClass("grape")).to.be.ok()}),it("(fn) : should invoke the callback with the correct arguments and context",function(){var a=[],c=[];b=b.children(),b.prepend(function(){a.push(toArray(arguments)),c.push(this)}),expect(a).to.eql([[0,"Apple"],[1,"Orange"],[2,"Pear"]]),expect(c).to.eql([b[0],b[1],b[2]])}),it("(fn) : should add returned string as first child",function(){var a,c,d;b=b.children(),b.prepend(function(){return'<div class="first">'}),a=b.eq(0),c=b.eq(1),d=b.eq(2),expect(a.find(".first")[0]).to.equal(a.contents()[0]),expect(c.find(".first")[0]).to.equal(c.contents()[0]),expect(d.find(".first")[0]).to.equal(d.contents()[0])}),it("(fn) : should add returned Cheerio object as first child",function(){var c,d,e;b=b.children(),b.prepend(function(){return a('<div class="second">')}),c=b.eq(0),d=b.eq(1),e=b.eq(2),expect(c.find(".second")[0]).to.equal(c.contents()[0]),expect(d.find(".second")[0]).to.equal(d.contents()[0]),expect(e.find(".second")[0]).to.equal(e.contents()[0])}),it("(fn) : should add returned Node as first child",function(){var c,d,e;b=b.children(),b.prepend(function(){return a('<div class="third">')[0]}),c=b.eq(0),d=b.eq(1),e=b.eq(2),expect(c.find(".third")[0]).to.equal(c.contents()[0]),expect(d.find(".third")[0]).to.equal(d.contents()[0]),expect(e.find(".third")[0]).to.equal(e.contents()[0])}),it("($(...)) : should remove from root element",function(){var c=a('<li class="plum">Plum</li>'),d=c[0].root;expect(d).to.be.ok(),b.prepend(c),expect(c[0].root).to.not.be.ok(),expect(d.childNodes).to.not.contain(c[0])})}),describe(".after",function(){it("() : should do nothing",function(){expect(a("#fruits").after()[0].tagName).to.equal("ul")}),it("(html) : should add element as next sibling",function(){var b='<li class="grape">Grape</li>';a(".apple").after(b),expect(a(".apple").next().hasClass("grape")).to.be.ok()}),it("(Array) : should add all elements in the array as next sibling",function(){var c=a('<li class="plum">Plum</li><li class="grape">Grape</li>').get();a(".apple").after(c),expect(b.children().eq(1).hasClass("plum")).to.be.ok(),expect(b.children().eq(2).hasClass("grape")).to.be.ok()}),it("($(...)) : should add element as next sibling",function(){var b=a('<li class="plum">Plum</li>');a(".apple").after(b),expect(a(".apple").next().hasClass("plum")).to.be.ok()}),it("(Node) : should add element as next sibling",function(){var b=a('<li class="plum">Plum</li>')[0];a(".apple").after(b),expect(a(".apple").next().hasClass("plum")).to.be.ok()}),it("(existing Node) : should remove existing nodes from previous locations",function(){var c,d=b.children()[2];a(".apple").after(d),c=b.children(),expect(c).to.have.length(3),expect(c[1]).to.be(d)}),it("(existing Node) : should update original direct siblings",function(){a(".pear").after(a(".orange")),expect(a(".apple").next()[0]).to.be(a(".pear")[0]),expect(a(".pear").prev()[0]).to.be(a(".apple")[0])}),it("(existing Node) : should clone all but the last occurrence",function(){var b=a(".apple");a(".orange, .pear").after(b),expect(a(".apple")).to.have.length(2),expect(a(".apple").eq(0).prev()[0]).to.be(a(".orange")[0]),expect(a(".apple").eq(0).next()[0]).to.be(a(".pear")[0]),expect(a(".apple").eq(1).prev()[0]).to.be(a(".pear")[0]),expect(a(".apple").eq(1).next()).to.have.length(0),expect(a(".apple")[0]).to.not.eql(b[0]),expect(a(".apple")[1]).to.eql(b[0])}),it("(elem) : should handle if removed",function(){var b=a(".apple"),c=a('<li class="plum">Plum</li>');b.remove(),b.after(c),expect(c.prev()).to.be.empty()}),it("($(...), html) : should add multiple elements as next siblings",function(){var b=a('<li class="plum">Plum</li>'),c='<li class="grape">Grape</li>';a(".apple").after(b,c),expect(a(".apple").next().hasClass("plum")).to.be.ok(),expect(a(".plum").next().hasClass("grape")).to.be.ok()}),it("(fn) : should invoke the callback with the correct arguments and context",function(){var a=[],c=[];b=b.children(),b.after(function(){a.push(toArray(arguments)),c.push(this)}),expect(a).to.eql([[0,"Apple"],[1,"Orange"],[2,"Pear"]]),expect(c).to.eql([b[0],b[1],b[2]])}),it("(fn) : should add returned string as next sibling",function(){b=b.children(),b.after(function(){return'<li class="first">'}),expect(a(".first")[0]).to.equal(a("#fruits").contents()[1]),expect(a(".first")[1]).to.equal(a("#fruits").contents()[3]),expect(a(".first")[2]).to.equal(a("#fruits").contents()[5])}),it("(fn) : should add returned Cheerio object as next sibling",function(){b=b.children(),b.after(function(){return a('<li class="second">')}),expect(a(".second")[0]).to.equal(a("#fruits").contents()[1]),expect(a(".second")[1]).to.equal(a("#fruits").contents()[3]),expect(a(".second")[2]).to.equal(a("#fruits").contents()[5])}),it("(fn) : should add returned element as next sibling",function(){b=b.children(),b.after(function(){return a('<li class="third">')[0]}),expect(a(".third")[0]).to.equal(a("#fruits").contents()[1]),expect(a(".third")[1]).to.equal(a("#fruits").contents()[3]),expect(a(".third")[2]).to.equal(a("#fruits").contents()[5])}),it("($(...)) : should remove from root element",function(){var c=a('<li class="plum">Plum</li>'),d=c[0].root;expect(d).to.be.ok(),b.after(c),expect(c[0].root).to.not.be.ok(),expect(d.childNodes).to.not.contain(c[0])})}),describe(".insertAfter",function(){it("(selector) : should create element and add as next sibling",function(){var b=a('<li class="grape">Grape</li>');b.insertAfter(".apple"),expect(a(".apple").next().hasClass("grape")).to.be.ok()}),it("(selector) : should create element and add as next sibling of multiple elements",function(){var b=a('<li class="grape">Grape</li>');b.insertAfter(".apple, .pear"),expect(a(".apple").next().hasClass("grape")).to.be.ok(),expect(a(".pear").next().hasClass("grape")).to.be.ok()}),it("($(...)) : should create element and add as next sibling",function(){var b=a('<li class="grape">Grape</li>');b.insertAfter(a(".apple")),expect(a(".apple").next().hasClass("grape")).to.be.ok()}),it("($(...)) : should create element and add as next sibling of multiple elements",function(){var b=a('<li class="grape">Grape</li>');b.insertAfter(a(".apple, .pear")),expect(a(".apple").next().hasClass("grape")).to.be.ok(),expect(a(".pear").next().hasClass("grape")).to.be.ok()}),it("($(...)) : should create all elements in the array and add as next siblings",function(){var c=a('<li class="plum">Plum</li><li class="grape">Grape</li>');c.insertAfter(a(".apple")),expect(b.children().eq(0).hasClass("apple")).to.be.ok(),expect(b.children().eq(1).hasClass("plum")).to.be.ok(),expect(b.children().eq(2).hasClass("grape")).to.be.ok()}),it("(existing Node) : should remove existing nodes from previous locations",function(){a(".orange").insertAfter(".pear"),expect(b.children().eq(1).hasClass("orange")).to.not.be.ok(),expect(b.children().length).to.be(3),expect(a(".orange").length).to.be(1)}),it("(existing Node) : should update original direct siblings",function(){a(".orange").insertAfter(".pear"),expect(a(".apple").next().hasClass("pear")).to.be.ok(),expect(a(".pear").prev().hasClass("apple")).to.be.ok(),expect(a(".pear").next().hasClass("orange")).to.be.ok(),expect(a(".orange").next()).to.be.empty()}),it("(existing Node) : should update original direct siblings of multiple elements",function(){a(".apple").insertAfter(".orange, .pear"),expect(a(".orange").prev()).to.be.empty(),expect(a(".orange").next().hasClass("apple")).to.be.ok(),expect(a(".pear").next().hasClass("apple")).to.be.ok(),expect(a(".pear").prev().hasClass("apple")).to.be.ok(),expect(b.children().length).to.be(4);var c=a(".apple");expect(c.length).to.be(2),expect(c.eq(0).prev().hasClass("orange")).to.be.ok(),expect(c.eq(1).prev().hasClass("pear")).to.be.ok()}),it("(elem) : should handle if removed",function(){var b=a(".apple"),c=a('<li class="plum">Plum</li>');b.remove(),c.insertAfter(b),expect(c.prev()).to.be.empty()}),it("(single) should return the new element for chaining",function(){var b=a('<li class="grape">Grape</li>').insertAfter(".apple");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(1),expect(b.hasClass("grape")).to.be.ok()}),it("(single) should return the new elements for chaining",function(){var b=a('<li class="grape">Grape</li><li class="plum">Plum</li>').insertAfter(".apple");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(2),expect(b.eq(0).hasClass("grape")).to.be.ok(),expect(b.eq(1).hasClass("plum")).to.be.ok()}),it("(multiple) should return the new elements for chaining",function(){var b=a('<li class="grape">Grape</li><li class="plum">Plum</li>').insertAfter(".apple, .pear");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(4),expect(b.eq(0).hasClass("grape")).to.be.ok(),expect(b.eq(1).hasClass("plum")).to.be.ok(),expect(b.eq(2).hasClass("grape")).to.be.ok(),expect(b.eq(3).hasClass("plum")).to.be.ok()}),it("(single) should return the existing element for chaining",function(){var b=a(".pear").insertAfter(".apple");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(1),expect(b.hasClass("pear")).to.be.ok()}),it("(single) should return the existing elements for chaining",function(){var b=a(".orange, .apple").insertAfter(".pear");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(2),expect(b.eq(0).hasClass("apple")).to.be.ok(),expect(b.eq(1).hasClass("orange")).to.be.ok()}),it("(multiple) should return the existing elements for chaining",function(){a('<li class="grape">Grape</li>').insertAfter(".apple");var b=a(".orange, .apple").insertAfter(".pear, .grape");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(4),expect(b.eq(0).hasClass("apple")).to.be.ok(),expect(b.eq(1).hasClass("orange")).to.be.ok(),expect(b.eq(2).hasClass("apple")).to.be.ok(),expect(b.eq(3).hasClass("orange")).to.be.ok()})}),describe(".before",function(){it("() : should do nothing",function(){expect(a("#fruits").before()[0].tagName).to.equal("ul")}),it("(html) : should add element as previous sibling",function(){var b='<li class="grape">Grape</li>';a(".apple").before(b),expect(a(".apple").prev().hasClass("grape")).to.be.ok()}),it("($(...)) : should add element as previous sibling",function(){var b=a('<li class="plum">Plum</li>');a(".apple").before(b),expect(a(".apple").prev().hasClass("plum")).to.be.ok()}),it("(Node) : should add element as previous sibling",function(){var b=a('<li class="plum">Plum</li>');a(".apple").before(b),expect(a(".apple").prev().hasClass("plum")).to.be.ok()}),it("(existing Node) : should remove existing nodes from previous locations",function(){var c,d=b.children()[2];a(".apple").before(d),c=b.children(),expect(c).to.have.length(3),expect(c[0]).to.be(d)}),it("(existing Node) : should update original direct siblings",function(){a(".apple").before(a(".orange")),expect(a(".apple").next()[0]).to.be(a(".pear")[0]),expect(a(".pear").prev()[0]).to.be(a(".apple")[0])}),it("(existing Node) : should clone all but the last occurrence",function(){var b=a(".pear");a(".apple, .orange").before(b),expect(a(".pear")).to.have.length(2),expect(a(".pear").eq(0).prev()).to.have.length(0),expect(a(".pear").eq(0).next()[0]).to.be(a(".apple")[0]),expect(a(".pear").eq(1).prev()[0]).to.be(a(".apple")[0]),expect(a(".pear").eq(1).next()[0]).to.be(a(".orange")[0]),expect(a(".pear")[0]).to.not.eql(b[0]),expect(a(".pear")[1]).to.eql(b[0])}),it("(elem) : should handle if removed",function(){var b=a(".apple"),c=a('<li class="plum">Plum</li>');b.remove(),b.before(c),expect(c.next()).to.be.empty()}),it("(Array) : should add all elements in the array as previous sibling",function(){var c=a('<li class="plum">Plum</li><li class="grape">Grape</li>').get();a(".apple").before(c),expect(b.children().eq(0).hasClass("plum")).to.be.ok(),expect(b.children().eq(1).hasClass("grape")).to.be.ok()}),it("($(...), html) : should add multiple elements as previous siblings",function(){var b=a('<li class="plum">Plum</li>'),c='<li class="grape">Grape</li>';a(".apple").before(b,c),expect(a(".apple").prev().hasClass("grape")).to.be.ok(),expect(a(".grape").prev().hasClass("plum")).to.be.ok()}),it("(fn) : should invoke the callback with the correct arguments and context",function(){var a=[],c=[];b=b.children(),b.before(function(){a.push(toArray(arguments)),c.push(this)}),expect(a).to.eql([[0,"Apple"],[1,"Orange"],[2,"Pear"]]),expect(c).to.eql([b[0],b[1],b[2]])}),it("(fn) : should add returned string as previous sibling",function(){b=b.children(),b.before(function(){return'<li class="first">'}),expect(a(".first")[0]).to.equal(a("#fruits").contents()[0]),expect(a(".first")[1]).to.equal(a("#fruits").contents()[2]),expect(a(".first")[2]).to.equal(a("#fruits").contents()[4])}),it("(fn) : should add returned Cheerio object as previous sibling",function(){b=b.children(),b.before(function(){return a('<li class="second">')}),expect(a(".second")[0]).to.equal(a("#fruits").contents()[0]),expect(a(".second")[1]).to.equal(a("#fruits").contents()[2]),expect(a(".second")[2]).to.equal(a("#fruits").contents()[4])}),it("(fn) : should add returned Node as previous sibling",function(){b=b.children(),b.before(function(){return a('<li class="third">')[0]}),expect(a(".third")[0]).to.equal(a("#fruits").contents()[0]),expect(a(".third")[1]).to.equal(a("#fruits").contents()[2]),expect(a(".third")[2]).to.equal(a("#fruits").contents()[4])}),it("($(...)) : should remove from root element",function(){var c=a('<li class="plum">Plum</li>'),d=c[0].root;expect(d).to.be.ok(),b.before(c),expect(c[0].root).to.not.be.ok(),expect(d.childNodes).to.not.contain(c[0])})}),describe(".insertBefore",function(){it("(selector) : should create element and add as prev sibling",function(){var b=a('<li class="grape">Grape</li>');b.insertBefore(".apple"),expect(a(".apple").prev().hasClass("grape")).to.be.ok()}),it("(selector) : should create element and add as prev sibling of multiple elements",function(){var b=a('<li class="grape">Grape</li>');b.insertBefore(".apple, .pear"),expect(a(".apple").prev().hasClass("grape")).to.be.ok(),expect(a(".pear").prev().hasClass("grape")).to.be.ok()}),it("($(...)) : should create element and add as prev sibling",function(){var b=a('<li class="grape">Grape</li>');b.insertBefore(a(".apple")),expect(a(".apple").prev().hasClass("grape")).to.be.ok()}),it("($(...)) : should create element and add as next sibling of multiple elements",function(){var b=a('<li class="grape">Grape</li>');b.insertBefore(a(".apple, .pear")),expect(a(".apple").prev().hasClass("grape")).to.be.ok(),expect(a(".pear").prev().hasClass("grape")).to.be.ok()}),it("($(...)) : should create all elements in the array and add as prev siblings",function(){var c=a('<li class="plum">Plum</li><li class="grape">Grape</li>');c.insertBefore(a(".apple")),expect(b.children().eq(0).hasClass("plum")).to.be.ok(),expect(b.children().eq(1).hasClass("grape")).to.be.ok(),expect(b.children().eq(2).hasClass("apple")).to.be.ok()}),it("(existing Node) : should remove existing nodes from previous locations",function(){a(".pear").insertBefore(".apple"),expect(b.children().eq(2).hasClass("pear")).to.not.be.ok(),expect(b.children().length).to.be(3),expect(a(".pear").length).to.be(1)}),it("(existing Node) : should update original direct siblings",function(){a(".pear").insertBefore(".apple"),expect(a(".apple").prev().hasClass("pear")).to.be.ok(),expect(a(".apple").next().hasClass("orange")).to.be.ok(),expect(a(".pear").next().hasClass("apple")).to.be.ok(),expect(a(".pear").prev()).to.be.empty()}),it("(existing Node) : should update original direct siblings of multiple elements",function(){a(".pear").insertBefore(".apple, .orange"),expect(a(".apple").prev().hasClass("pear")).to.be.ok(),expect(a(".apple").next().hasClass("pear")).to.be.ok(),expect(a(".orange").prev().hasClass("pear")).to.be.ok(),expect(a(".orange").next()).to.be.empty(),expect(b.children().length).to.be(4);var c=a(".pear");expect(c.length).to.be(2),expect(c.eq(0).next().hasClass("apple")).to.be.ok(),expect(c.eq(1).next().hasClass("orange")).to.be.ok()}),it("(elem) : should handle if removed",function(){var b=a(".apple"),c=a('<li class="plum">Plum</li>');b.remove(),c.insertBefore(b),expect(c.next()).to.be.empty()}),it("(single) should return the new element for chaining",function(){var b=a('<li class="grape">Grape</li>').insertBefore(".apple");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(1),expect(b.hasClass("grape")).to.be.ok()}),it("(single) should return the new elements for chaining",function(){var b=a('<li class="grape">Grape</li><li class="plum">Plum</li>').insertBefore(".apple");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(2),expect(b.eq(0).hasClass("grape")).to.be.ok(),expect(b.eq(1).hasClass("plum")).to.be.ok()}),it("(multiple) should return the new elements for chaining",function(){var b=a('<li class="grape">Grape</li><li class="plum">Plum</li>').insertBefore(".apple, .pear");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(4),expect(b.eq(0).hasClass("grape")).to.be.ok(),expect(b.eq(1).hasClass("plum")).to.be.ok(),expect(b.eq(2).hasClass("grape")).to.be.ok(),expect(b.eq(3).hasClass("plum")).to.be.ok()}),it("(single) should return the existing element for chaining",function(){var b=a(".orange").insertBefore(".apple");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(1),expect(b.hasClass("orange")).to.be.ok()}),it("(single) should return the existing elements for chaining",function(){var b=a(".orange, .pear").insertBefore(".apple");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(2),expect(b.eq(0).hasClass("orange")).to.be.ok(),expect(b.eq(1).hasClass("pear")).to.be.ok()}),it("(multiple) should return the existing elements for chaining",function(){a('<li class="grape">Grape</li>').insertBefore(".apple");var b=a(".orange, .apple").insertBefore(".pear, .grape");expect(b.cheerio).to.be.ok(),expect(b.each).to.be.ok(),expect(b.length).to.be(4),expect(b.eq(0).hasClass("apple")).to.be.ok(),expect(b.eq(1).hasClass("orange")).to.be.ok(),expect(b.eq(2).hasClass("apple")).to.be.ok(),expect(b.eq(3).hasClass("orange")).to.be.ok()})}),describe(".remove",function(){it("() : should remove selected elements",function(){a(".apple").remove(),expect(b.find(".apple")).to.have.length(0)}),it("() : should be reentrant",function(){var c=a(".apple");c.remove(),c.remove(),expect(b.find(".apple")).to.have.length(0)}),it("(selector) : should remove matching selected elements",function(){a("li").remove(".apple"),expect(b.find(".apple")).to.have.length(0)}),it("($(...)) : should remove from root element",function(){var b=a('<li class="plum">Plum</li>'),c=b[0].root;expect(c).to.be.ok(),b.remove(),expect(b[0].root).to.not.be.ok(),expect(c.childNodes).to.not.contain(b[0])})}),describe(".replaceWith",function(){it("(elem) : should replace one <li> tag with another",function(){var b=a('<li class="plum">Plum</li>');a(".pear").replaceWith(b),expect(a(".orange").next().hasClass("plum")).to.be.ok(),expect(a(".orange").next().html()).to.equal("Plum")}),it("(Array) : should replace one <li> tag with the elements in the array",function(){var c=a('<li class="plum">Plum</li><li class="grape">Grape</li>').get();a(".pear").replaceWith(c),expect(b.children().eq(2).hasClass("plum")).to.be.ok(),expect(b.children().eq(3).hasClass("grape")).to.be.ok(),expect(b.children()).to.have.length(4)}),it("(Node) : should replace the selected element with given node",function(){var b=a("<h2>hi <span>there</span></h2>"),c=a("<ul></ul>"),d=b.find("span").replaceWith(c[0]);expect(c[0].parentNode).to.equal(b[0]),expect(d[0].parentNode).to.equal(null),expect(a.html(b)).to.equal("<h2>hi <ul></ul></h2>")}),it("(existing element) : should remove element from its previous location",function(){a(".pear").replaceWith(a(".apple")),expect(b.children()).to.have.length(2),expect(b.children()[0]).to.equal(a(".orange")[0]),expect(b.children()[1]).to.equal(a(".apple")[0])}),it("(elem) : should NOP if removed",function(){var b=a(".pear"),c=a('<li class="plum">Plum</li>');b.remove(),b.replaceWith(c),expect(a(".orange").next().hasClass("plum")).to.not.be.ok()}),it("(elem) : should replace the single selected element with given element",function(){var b=a("<h2>hi <span>there</span></h2>"),c=a("<div>here</div>"),d=b.find("span").replaceWith(c);expect(c[0].parentNode).to.equal(b[0]),expect(d[0].parentNode).to.equal(null),expect(a.html(b)).to.equal("<h2>hi <div>here</div></h2>")}),it("(str) : should accept strings",function(){var b=a("<h2>hi <span>there</span></h2>"),c="<div>here</div>",d=b.find("span").replaceWith(c);expect(d[0].parentNode).to.equal(null),expect(a.html(b)).to.equal("<h2>hi <div>here</div></h2>")}),it("(str) : should replace all selected elements",function(){var b=a("<b>a<br>b<br>c<br>d</b>"),c=b.find("br").replaceWith(" ");expect(c[0].parentNode).to.equal(null),expect(a.html(b)).to.equal("<b>a b c d</b>")}),it("(fn) : should invoke the callback with the correct argument and context",function(){var a=b.children().get(),c=[],d=[];b.children().replaceWith(function(){return c.push(toArray(arguments)),d.push(this),'<li class="first">'}),expect(c).to.eql([[0,a[0]],[1,a[1]],[2,a[2]]]),expect(d).to.eql([a[0],a[1],a[2]])}),it("(fn) : should replace the selected element with the returned string",function(){b.children().replaceWith(function(){return'<li class="first">'}),expect(b.find(".first")).to.have.length(3)}),it("(fn) : should replace the selected element with the returned Cheerio object",function(){b.children().replaceWith(function(){return a('<li class="second">')}),expect(b.find(".second")).to.have.length(3)}),it("(fn) : should replace the selected element with the returned node",function(){b.children().replaceWith(function(){return a('<li class="third">')[0]}),expect(b.find(".third")).to.have.length(3)}),it("($(...)) : should remove from root element",function(){var c=a('<li class="plum">Plum</li>'),d=c[0].root;expect(d).to.be.ok(),b.children().replaceWith(c),expect(c[0].root).to.not.be.ok(),expect(d.childNodes).to.not.contain(c[0])})}),describe(".empty",function(){it("() : should remove all children from selected elements",function(){expect(b.children()).to.have.length(3),b.empty(),expect(b.children()).to.have.length(0)}),it("() : should allow element reinsertion",function(){var c=b.children();b.empty(),expect(b.children()).to.have.length(0),expect(c).to.have.length(3),b.append(a("<div></div><div></div>"));var d=b.children().eq(0);d.replaceWith(c),expect(b.children()).to.have.length(4)}),it("() : should destroy children's references to the parent",function(){var a=b.children();b.empty(),expect(a.eq(0).parent()).to.have.length(0),expect(a.eq(0).next()).to.have.length(0),expect(a.eq(0).prev()).to.have.length(0),expect(a.eq(1).parent()).to.have.length(0),expect(a.eq(1).next()).to.have.length(0),expect(a.eq(1).prev()).to.have.length(0),expect(a.eq(2).parent()).to.have.length(0),expect(a.eq(2).next()).to.have.length(0),expect(a.eq(2).prev()).to.have.length(0)})}),describe(".html",function(){it("() : should get the innerHTML for an element",function(){expect(b.html()).to.equal(['<li class="apple">Apple</li>','<li class="orange">Orange</li>','<li class="pear">Pear</li>'].join(""))}),it("() : should get innerHTML even if its just text",function(){var b='<li class="pear">Pear</li>';expect(a(".pear",b).html()).to.equal("Pear")}),it("() : should return empty string if nothing inside",function(){var b="<li></li>";expect(a("li",b).html()).to.equal("")}),it("(html) : should set the html for its children",function(){b.html('<li class="durian">Durian</li>');var a=b.html();expect(a).to.equal('<li class="durian">Durian</li>')}),it("(html) : should add new elements for each element in selection",function(){var b=a("li");b.html('<li class="durian">Durian</li>');var c=0;b.each(function(){expect(a(this).children().parent().get(0)).to.equal(this),c++}),expect(c).to.equal(3)}),it("(elem) : should set the html for its children with element",function(){b.html(a('<li class="durian">Durian</li>'));var c=b.html();expect(c).to.equal('<li class="durian">Durian</li>')}),it("() : should allow element reinsertion",function(){var a=b.children();b.html("<div></div><div></div>"),expect(b.children()).to.have.length(2);var c=b.children().eq(0);c.replaceWith(a),expect(b.children()).to.have.length(4)})}),describe(".toString",function(){it("() : should get the outerHTML for an element",function(){expect(b.toString()).to.equal(fruits)}),it("() : should return an html string for a set of elements",function(){expect(b.find("li").toString()).to.equal('<li class="apple">Apple</li><li class="orange">Orange</li><li class="pear">Pear</li>')}),it("() : should be called implicitly",function(){var b=[a("<foo>"),a("<bar>"),a("<baz>")].join("");expect(b).to.equal("<foo></foo><bar></bar><baz></baz>")}),it("() : should pass options",function(){var a=cheerio.load("&",{decodeEntities:!1});expect(a.root().toString()).to.equal("&")})}),describe(".text",function(){it("() : gets the text for a single element",function(){expect(a(".apple").text()).to.equal("Apple")}),it("() : combines all text from children text nodes",function(){expect(a("#fruits").text()).to.equal("AppleOrangePear")}),it("(text) : sets the text for the child node",function(){a(".apple").text("Granny Smith Apple"),expect(a(".apple")[0].childNodes[0].data).to.equal("Granny Smith Apple")}),it("(text) : inserts separate nodes for all children",function(){a("li").text("Fruits");var b=0;a("li").each(function(){expect(this.childNodes[0].parent).to.equal(this),
b++}),expect(b).to.equal(3)}),it("should allow functions as arguments",function(){a(".apple").text(function(a,b){return expect(a).to.equal(0),expect(b).to.equal("Apple"),"whatever mate"}),expect(a(".apple")[0].childNodes[0].data).to.equal("whatever mate")}),it("should decode special chars",function(){var b=a("<p>M&amp;M</p>").text();expect(b).to.equal("M&M")}),it("should work with special chars added as strings",function(){var b=a("<p>M&M</p>").text();expect(b).to.equal("M&M")}),it("( undefined ) : should act as an accessor",function(){var b=a("<div>test</div>");expect(b.text(void 0)).to.be.a("string"),expect(b.text()).to.be("test")}),it('( "" ) : should convert to string',function(){var b=a("<div>test</div>");expect(b.text("").text()).to.equal("")}),it("( null ) : should convert to string",function(){expect(a("<div>").text(null).text()).to.equal("null")}),it("( 0 ) : should convert to string",function(){expect(a("<div>").text(0).text()).to.equal("0")}),it("(str) should encode then decode unsafe characters",function(){var b=a(".apple");b.text('blah <script>alert("XSS!")</script> blah'),expect(b[0].childNodes[0].data).to.equal('blah <script>alert("XSS!")</script> blah'),expect(b.text()).to.equal('blah <script>alert("XSS!")</script> blah'),b.text('blah <script>alert("XSS!")</script> blah'),expect(b.html()).to.not.contain('<script>alert("XSS!")</script>')})})});
var expect=require("expect.js"),parse=require("../lib/parse"),defaultOpts=require("..").prototype.options,basic="<html></html>",siblings="<h2></h2><p></p>",single="<br/>",singleWrong="<br>",children="<html><br/></html>",li='<li class="durian">Durian</li>',attributes='<img src="hello.png" alt="man waving">',noValueAttribute="<textarea disabled></textarea>",comment="<!-- sexy -->",conditional='<!--[if IE 8]><html class="no-js ie8" lang="en"><![endif]-->',text="lorem ipsum",script='<script type="text/javascript">alert("hi world!");</script>',scriptEmpty="<script></script>",style='<style type="text/css"> h2 { color:blue; } </style>',styleEmpty="<style></style>",directive="<!doctype html>";describe("parse",function(){describe(".eval",function(){it("should parse basic empty tags: "+basic,function(){var a=parse.evaluate(basic,defaultOpts)[0];expect(a.type).to.equal("tag"),expect(a.tagName).to.equal("html"),expect(a.childNodes).to.be.empty()}),it("should handle sibling tags: "+siblings,function(){var a=parse.evaluate(siblings,defaultOpts),b=a[0],c=a[1];expect(a).to.have.length(2),expect(b.tagName).to.equal("h2"),expect(c.tagName).to.equal("p")}),it("should handle single tags: "+single,function(){var a=parse.evaluate(single,defaultOpts)[0];expect(a.type).to.equal("tag"),expect(a.tagName).to.equal("br"),expect(a.childNodes).to.be.empty()}),it("should handle malformatted single tags: "+singleWrong,function(){var a=parse.evaluate(singleWrong,defaultOpts)[0];expect(a.type).to.equal("tag"),expect(a.tagName).to.equal("br"),expect(a.childNodes).to.be.empty()}),it("should handle tags with children: "+children,function(){var a=parse.evaluate(children,defaultOpts)[0];expect(a.type).to.equal("tag"),expect(a.tagName).to.equal("html"),expect(a.childNodes).to.be.ok(),expect(a.childNodes).to.have.length(1)}),it("should handle tags with children: "+li,function(){var a=parse.evaluate(li,defaultOpts)[0];expect(a.childNodes).to.have.length(1),expect(a.childNodes[0].data).to.equal("Durian")}),it("should handle tags with attributes: "+attributes,function(){var a=parse.evaluate(attributes,defaultOpts)[0].attribs;expect(a).to.be.ok(),expect(a.src).to.equal("hello.png"),expect(a.alt).to.equal("man waving")}),it("should handle value-less attributes: "+noValueAttribute,function(){var a=parse.evaluate(noValueAttribute,defaultOpts)[0].attribs;expect(a).to.be.ok(),expect(a.disabled).to.equal("")}),it("should handle comments: "+comment,function(){var a=parse.evaluate(comment,defaultOpts)[0];expect(a.type).to.equal("comment"),expect(a.data).to.equal(" sexy ")}),it("should handle conditional comments: "+conditional,function(){var a=parse.evaluate(conditional,defaultOpts)[0];expect(a.type).to.equal("comment"),expect(a.data).to.equal(conditional.replace("<!--","").replace("-->",""))}),it("should handle text: "+text,function(){var a=parse.evaluate(text,defaultOpts)[0];expect(a.type).to.equal("text"),expect(a.data).to.equal("lorem ipsum")}),it("should handle script tags: "+script,function(){var a=parse.evaluate(script,defaultOpts)[0];expect(a.type).to.equal("script"),expect(a.tagName).to.equal("script"),expect(a.attribs.type).to.equal("text/javascript"),expect(a.childNodes).to.have.length(1),expect(a.childNodes[0].type).to.equal("text"),expect(a.childNodes[0].data).to.equal('alert("hi world!");')}),it("should handle style tags: "+style,function(){var a=parse.evaluate(style,defaultOpts)[0];expect(a.type).to.equal("style"),expect(a.tagName).to.equal("style"),expect(a.attribs.type).to.equal("text/css"),expect(a.childNodes).to.have.length(1),expect(a.childNodes[0].type).to.equal("text"),expect(a.childNodes[0].data).to.equal(" h2 { color:blue; } ")}),it("should handle directives: "+directive,function(){var a=parse.evaluate(directive,defaultOpts)[0];expect(a.type).to.equal("directive"),expect(a.data).to.equal("!doctype html"),expect(a.tagName).to.equal("!doctype")})}),describe(".parse",function(){function a(a){expect(a.tagName).to.equal("root"),expect(a.nextSibling).to.be(null),expect(a.previousSibling).to.be(null),expect(a.parentNode).to.be(null);var b=a.childNodes[0];expect(b.parentNode).to.be(null)}it("should add root to: "+basic,function(){var b=parse(basic,defaultOpts);a(b),expect(b.childNodes).to.have.length(1),expect(b.childNodes[0].tagName).to.equal("html")}),it("should add root to: "+siblings,function(){var b=parse(siblings,defaultOpts);a(b),expect(b.childNodes).to.have.length(2),expect(b.childNodes[0].tagName).to.equal("h2"),expect(b.childNodes[1].tagName).to.equal("p"),expect(b.childNodes[1].parent).to.equal(null)}),it("should add root to: "+comment,function(){var b=parse(comment,defaultOpts);a(b),expect(b.childNodes).to.have.length(1),expect(b.childNodes[0].type).to.equal("comment")}),it("should add root to: "+text,function(){var b=parse(text,defaultOpts);a(b),expect(b.childNodes).to.have.length(1),expect(b.childNodes[0].type).to.equal("text")}),it("should add root to: "+scriptEmpty,function(){var b=parse(scriptEmpty,defaultOpts);a(b),expect(b.childNodes).to.have.length(1),expect(b.childNodes[0].type).to.equal("script")}),it("should add root to: "+styleEmpty,function(){var b=parse(styleEmpty,defaultOpts);a(b),expect(b.childNodes).to.have.length(1),expect(b.childNodes[0].type).to.equal("style")}),it("should add root to: "+directive,function(){var b=parse(directive,defaultOpts);a(b),expect(b.childNodes).to.have.length(1),expect(b.childNodes[0].type).to.equal("directive")}),it("should expose the DOM level 1 API",function(){var a=parse("<div><a></a><span></span><p></p></div>",defaultOpts).childNodes[0],b=a.childNodes;expect(b).to.have.length(3),expect(a.tagName).to.be("div"),expect(a.firstChild).to.be(b[0]),expect(a.lastChild).to.be(b[2]),expect(b[0].tagName).to.be("a"),expect(b[0].previousSibling).to.be(null),expect(b[0].nextSibling).to.be(b[1]),expect(b[0].parentNode).to.be(a),expect(b[0].childNodes).to.have.length(0),expect(b[0].firstChild).to.be(null),expect(b[0].lastChild).to.be(null),expect(b[1].tagName).to.be("span"),expect(b[1].previousSibling).to.be(b[0]),expect(b[1].nextSibling).to.be(b[2]),expect(b[1].parentNode).to.be(a),expect(b[1].childNodes).to.have.length(0),expect(b[1].firstChild).to.be(null),expect(b[1].lastChild).to.be(null),expect(b[2].tagName).to.be("p"),expect(b[2].previousSibling).to.be(b[1]),expect(b[2].nextSibling).to.be(null),expect(b[2].parentNode).to.be(a),expect(b[2].childNodes).to.have.length(0),expect(b[2].firstChild).to.be(null),expect(b[2].lastChild).to.be(null)})})});
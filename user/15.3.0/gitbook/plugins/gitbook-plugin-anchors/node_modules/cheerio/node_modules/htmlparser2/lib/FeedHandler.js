function FeedHandler(a,b){this.init(a,b)}function getElements(a,b){return DomUtils.getElementsByTagName(a,b,!0)}function getOneElement(a,b){return DomUtils.getElementsByTagName(a,b,!0,1)[0]}function fetch(a,b,c){return DomUtils.getText(DomUtils.getElementsByTagName(a,b,c,1)).trim()}function addConditionally(a,b,c,d,e){var f=fetch(c,d,e);f&&(a[b]=f)}var index=require("./index.js"),DomHandler=index.DomHandler,DomUtils=index.DomUtils;require("util").inherits(FeedHandler,DomHandler),FeedHandler.prototype.init=DomHandler;var isValidFeed=function(a){return"rss"===a||"feed"===a||"rdf:RDF"===a};FeedHandler.prototype.onend=function(){var a,b,c={},d=getOneElement(isValidFeed,this.dom);d&&("feed"===d.name?(b=d.children,c.type="atom",addConditionally(c,"id","id",b),addConditionally(c,"title","title",b),(a=getOneElement("link",b))&&(a=a.attribs)&&(a=a.href)&&(c.link=a),addConditionally(c,"description","subtitle",b),(a=fetch("updated",b))&&(c.updated=new Date(a)),addConditionally(c,"author","email",b,!0),c.items=getElements("entry",b).map(function(a){var b,c={};return a=a.children,addConditionally(c,"id","id",a),addConditionally(c,"title","title",a),(b=getOneElement("link",a))&&(b=b.attribs)&&(b=b.href)&&(c.link=b),(b=fetch("summary",a)||fetch("content",a))&&(c.description=b),(b=fetch("updated",a))&&(c.pubDate=new Date(b)),c})):(b=getOneElement("channel",d.children).children,c.type=d.name.substr(0,3),c.id="",addConditionally(c,"title","title",b),addConditionally(c,"link","link",b),addConditionally(c,"description","description",b),(a=fetch("lastBuildDate",b))&&(c.updated=new Date(a)),addConditionally(c,"author","managingEditor",b,!0),c.items=getElements("item",d.children).map(function(a){var b,c={};return a=a.children,addConditionally(c,"id","guid",a),addConditionally(c,"title","title",a),addConditionally(c,"link","link",a),addConditionally(c,"description","description",a),(b=fetch("pubDate",a))&&(c.pubDate=new Date(b)),c}))),this.dom=c,DomHandler.prototype._handleCallback.call(this,d?null:Error("couldn't find root of feed"))},module.exports=FeedHandler;